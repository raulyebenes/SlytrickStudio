class Escena2 extends Phaser.Scene{
    constructor() {
        super("juego");
        
    }
    
    preload(){
        this.load.image("fondo", "assets/ventana.png");
        this.load.image("plataforma", "assets/plataforma.png");
        this.load.image("plat_muelle", "assets/plat_muelle.png");
        this.load.image("plat_pegajoso", "assets/plat_pegajoso.png");
        this.load.image("plat_pinchos", "assets/plat_pinchos.png");
        this.load.image("cubo", "assets/cubo.png");
    }
    
    create() {
        
             
        this.background = this.add.tileSprite(0,0, config.width,
                config.height, "fondo");
        this.background.setOrigin(0,0);
        
        plat = this.physics.add.group();
        
        this.add.text(20, 20, "Probando cositas guapis", {font:"25px Arial Black", fill: "black"});
        
        cubo = this.physics.add.sprite(50, config.height/2-36, "cubo");
        cubo.setCollideWorldBounds(true);
        
        this.cursors = this.input.keyboard.createCursorKeys();
        
    }
               
    update() {
        this.background.tilePositionY += 0;
        if(vel <= 10) {
            vel += 0.01;
        }
        cuboX = cubo.x;
        cuboY = cubo.y;
        if(flipflop){
            if (this.cursors.left.isDown){
                    flipflop = false;
                    crearPlataforma();
                    lastPress= true;
                    if(cubo.x > 50){
                        nuevaX = cuboX-80;
                        this.physics.moveTo(
                                cubo, cuboX-80, cuboY, 80, 100);
                    }
            }else if (this.cursors.right.isDown){
                    flipflop = false;
                    crearPlataforma();
                    lastPress= false;
                    if(cubo.x < 450){
                        nuevaX = cuboX+80;
                        this.physics.moveTo(
                                cubo, cuboX+80, cuboY, 80, 100);
                    }
            }
        }
        if(this.cursors.right.isUp && this.cursors.left.isUp){
            if(lastPress){
                if(nuevaX >= cuboX){
                    cubo.setVelocityX(0);
                    cubo.x = nuevaX;
                    flipflop=true;
                } 
            } else if(!lastPress) {
                if(nuevaX <= cuboX){
                    cubo.setVelocityX(0);
                    cubo.x = nuevaX;
                    flipflop=true;
                }
            }
        } 
    }
    
}

function crearPlataforma(){
        randomPlat = Math.floor((Math.random() * 4));
        arrayPlat = ["plataforma", "plat_muelle", "plat_pegajoso", "plat_pinchos"];
        switch(randomPlat){
            case 0:
                var plataforma = plat.create(
                config.width/2, config.height/2,  "plataforma");
                entra = true;
            break;
            
            case 1:
                var plataforma = plat.create(
                config.width/2, config.height/2, "plat_muelle");
                entra = true;
            break;
            case 2:
                var plataforma = plat.create(
                config.width/2, config.height/2,  "plat_pegajoso");
                entra = true;
                break;
            
            case 3:
                var plataforma = plat.create(
                config.width/2, config.height/2,  "plat_pinchos");
                entra = true;
                break;
        
        }
}
